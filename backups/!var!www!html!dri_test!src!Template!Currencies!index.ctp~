<div class="large-2">
          <br/>

<script>
var currencies;
function loadCurrencyRates()
{
        $.ajax({url:"/currencies/index.json",dataType:"json"}).done(function(data)
        {
              currencies=data.allCurrencies;
        });
}

function convert(from,to,amount)
{
   var fromRate,toRate;
   currencies.forEach(function(currency)
   {
        if(currency.iso_4217===from)
        {
           fromRate=currency.rate;
        }
        if(currency.iso_4217===to)
        {
          toRate=currency.rate;
        }
   });
   if(fromRate && toRate)
      return toRate/fromRate * amount;
   else
     throw "Weird currencies";
}

function calculate()
{
   $('#result').val( convert($('#fromCurr').val(),$('#toCurr').val(),$('#amount').val()));
}

loadCurrencyRates();
</script>
<input type="number" oninput="calculate();" id='amount' />
<select class='currencyList id="fromCurr"  onchange='calculate();'>
<?= $this->element("CurrencyOptionList") ?>
</select>
<input type="text" disabled id='result'/>
<select class='currencyList' id="toCurr"  onchange='calculate();'>
<?= $this->element("CurrencyOptionList") ?>
</select>
</div>
<div class="actions columns large-2 medium-3">
    <h3><?= __('Actions') ?></h3>
    <ul class="side-nav">
        <li>
            <a onclick="$('#currencyContent').load('/Currencies/updateCurrencies',
            function(){
                        loadCurrencyRates();
                        if($('.currencyList').children().size()<1)
                        {
                            $('.currencyList').load('/Currencies/currencyList');
                        }
            });">
                <?= __("Update currencies"); ?>
            </a>
        </li>
        <li>
            <a onclick="$('#currencyContent').load('/Currencies/clearCurrencies');">
                <?= __("Clear currencies"); ?>
            </a>
        </li>

    </ul>
      
</div>
<div id='currencyContent'>
<?= $this->element('currencyContent') ?>
</div>